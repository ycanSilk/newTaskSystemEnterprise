# 修改 src/app/publisher/create/douyin/page.tsx 执行计划

## 1. 任务分析

### 1.1 现有代码结构
- 页面包含静态定义的任务类型数组 `TASK_TYPES`
- 使用 `TaskCard` 组件渲染任务列表
- 点击任务卡片跳转到相应的任务发布页面

### 1.2 需要修改的内容
1. 删除静态任务类型定义 `TASK_TYPES`
2. 添加API调用功能，获取动态任务模板
3. 创建类型定义文件
4. 修改页面渲染逻辑，使用动态数据

## 2. 实施步骤

### 2.1 创建类型定义文件

**文件路径**：`src/app/types/task/getTaskTemplatesTypes.ts`

**内容**：
- 定义任务模板类型 `TaskTemplate`
- 定义API响应类型 `GetTaskTemplatesResponse`
- 定义任务阶段类型 `TaskStage`（用于组合任务）

### 2.2 修改页面代码

**文件路径**：`src/app/publisher/create/douyin/page.tsx`

**修改步骤**：
1. 删除静态任务类型定义 `TASK_TYPES`
2. 添加状态管理：
   - `taskTemplates`：存储从API获取的任务模板
   - `loading`：加载状态
   - `error`：错误状态
3. 添加API调用逻辑：
   - 使用 `useEffect` 在页面加载时调用API
   - 调用 `/api/task/getTaskTemplates` 路由
   - 处理响应数据
4. 修改渲染逻辑：
   - 使用 `taskTemplates` 替代 `TASK_TYPES`
   - 添加加载状态显示
   - 添加错误处理
5. 调整 `TaskCard` 组件，确保能正确渲染动态数据
6. 调整 `handleTaskClick` 函数，根据新的数据结构处理跳转

### 2.3 遵循API_REQUEST_STANDARD.md规范

- 使用正确的导入路径
- 遵循类型定义规范
- 遵循API调用规范
- 遵循代码风格规范
- 添加适当的注释

## 3. 代码实现细节

### 3.1 类型定义

```typescript
// src/app/types/task/getTaskTemplatesTypes.ts

// 任务阶段接口（组合任务特有）
export interface TaskStage {
  title: string;
  price: number;
  default_count: number;
}

// 任务模板接口
export interface TaskTemplate {
  id: number;
  type: 0 | 1; // 0: 单任务, 1: 组合任务
  type_text: string;
  title: string;
  price: number;
  description1: string;
  description2: string;
  created_at: string;
  stage1?: TaskStage;
  stage2?: TaskStage;
  default_total_price?: number;
}

// API响应接口
export interface GetTaskTemplatesResponse {
  success: boolean;
  message: string;
  data: TaskTemplate[];
  timestamp: number;
}
```

### 3.2 页面修改

```typescript
// src/app/publisher/create/douyin/page.tsx
'use client';

import { Card, Button, Input, Badge, AlertModal } from '@/components/ui';
import { useRouter } from 'next/navigation';
import { useState, useEffect } from 'react';
import { TaskTemplate, GetTaskTemplatesResponse } from '@/app/types/task/getTaskTemplatesTypes';

// 任务卡片组件
const TaskCard = ({ task, onClick }: { task: TaskTemplate, onClick: () => void }) => {
  return (
    <div 
      onClick={onClick}
      className="bg-white rounded-2xl px-5 py-3 shadow-sm border-2 border-gray-100 hover:border-blue-200 hover:shadow-md transition-all cursor-pointer active:scale-95"
    >
      {/* 任务头部 */}
      <div className="flex items-center justify-between">
        <div className="flex items-center space-x-3">
            <h3 className="font-bold text-lg">{task.title}</h3>
        </div>
        <div className="text-right">
          <div className="text-2xl font-bold text-orange-500">
            ¥{task.price}
          </div>
        </div>
      </div>

      {/* 任务描述 */}
      <div className="mb-2">
        <p className="">{task.description1}</p>
        <p className="text-gray-700 text-sm">{task.description2}</p>
      </div>

      {/* 发布按钮 */}
      <div className="flex items-center justify-end">
        <div className="bg-blue-500 text-white px-4 py-2 rounded-lg text-sm font-medium">
          立即发布
        </div>
      </div>
    </div>
  );
};

export default function CreateTask() {
  const router = useRouter();
  
  // 任务模板状态
  const [taskTemplates, setTaskTemplates] = useState<TaskTemplate[]>([]);
  const [loading, setLoading] = useState<boolean>(true);
  const [error, setError] = useState<string | null>(null);
  
  // 提示框状态
  const [showAlertModal, setShowAlertModal] = useState(false);
  const [alertConfig, setAlertConfig] = useState({
    title: '',
    message: '',
    icon: ''
  });
  
  // 显示暂未开发提示
  const showNotDevelopedAlert = () => {
    setAlertConfig({
      title: '暂未开发',
      message: '该功能暂未开发',
      icon: '🔧'
    });
    setShowAlertModal(true);
  };

  // 获取任务模板
  useEffect(() => {
    const fetchTaskTemplates = async () => {
      try {
        setLoading(true);
        setError(null);
        
        const response = await fetch('/api/task/getTaskTemplates');
        const data: GetTaskTemplatesResponse = await response.json();
        
        if (data.success && data.data) {
          setTaskTemplates(data.data);
        } else {
          setError(data.message || '获取任务模板失败');
        }
      } catch (err) {
        setError('网络错误，无法获取任务模板');
        console.error('获取任务模板失败:', err);
      } finally {
        setLoading(false);
      }
    };
    
    fetchTaskTemplates();
  }, []);

  const handleTaskClick = (task: TaskTemplate) => {
    // 处理任务选择，根据title或其他字段判断跳转路径
    // 这里需要根据实际业务逻辑调整
    showNotDevelopedAlert();
  };

  return (
    <div className="space-y-6 pb-10 mt-5">
      {/* 加载状态 */}
      {loading && (
        <div className="px-2 space-y-2">
          <div className="bg-white rounded-2xl px-5 py-3 shadow-sm border-2 border-gray-100">
            <div className="flex items-center justify-center py-10">
              <div className="text-gray-500">加载中...</div>
            </div>
          </div>
        </div>
      )}
      
      {/* 错误状态 */}
      {error && (
        <div className="px-2 space-y-2">
          <div className="bg-red-50 rounded-2xl px-5 py-3">
            <div className="text-red-500">{error}</div>
          </div>
        </div>
      )}
      
      {/* 任务卡片列表 */}
      {!loading && !error && taskTemplates.length > 0 && (
        <div className="px-2 space-y-2">
          {taskTemplates.map((task) => (
            <TaskCard 
              key={task.id} 
              task={task} 
              onClick={() => handleTaskClick(task)}
            />
          ))}
        </div>
      )}
      
      {/* 空状态 */}
      {!loading && !error && taskTemplates.length === 0 && (
        <div className="px-2 space-y-2">
          <div className="bg-white rounded-2xl px-5 py-3 shadow-sm border-2 border-gray-100">
            <div className="flex items-center justify-center py-10">
              <div className="text-gray-500">暂无任务模板</div>
            </div>
          </div>
        </div>
      )}

      {/* 提示信息 */}
      <div className="px-2 space-y-2">
        <div className="bg-blue-50 rounded-2xl p-4">
          <div className="flex items-start space-x-3">
            <div>
              <h3 className="font-medium text-blue-900 mb-1">任务说明</h3>
              <p className="text-blue-700 text-sm leading-relaxed">
                请根据您的需求选择合适的任务类型。发布评论需求请规避抖音平台敏感词，否则会无法完成任务导致浪费宝贵时间。
              </p>
            </div>
          </div>
        </div>
      </div>
      
      {/* 通用提示模态框 */}
      <AlertModal
        isOpen={showAlertModal}
        title={alertConfig.title}
        message={alertConfig.message}
        icon={alertConfig.icon}
        onClose={() => setShowAlertModal(false)}
      />
    </div>
  );
}
```

## 4. 验证和测试

1. 确保页面能正确加载并显示任务模板
2. 确保加载状态和错误状态能正确显示
3. 确保点击任务卡片能正确处理
4. 确保所有代码都遵循API_REQUEST_STANDARD.md规范
5. 运行构建命令，确保没有类型错误

## 5. 预期结果

- 页面保留原有的UI布局和样式
- 页面加载时通过API获取任务模板
- 任务模板数据动态渲染到页面上
- 支持加载状态和错误状态显示
- 代码遵循项目的标准化规范
- 类型定义完整，确保类型安全