# 个人开发规范

## 1. 项目架构

### 1.1 技术栈
- **框架**: Next.js 14.2.5
- **语言**: TypeScript 5.3.3
- **状态管理**: Zustand 4.5.7
- **API请求**: React Query 5.90.20
- **UI组件**: Ant Design 6.0.0
- **样式**: Tailwind CSS 3.3.6
- **HTTP客户端**: Axios 1.12.2

### 1.2 目录结构
```
src/
├── app/             # Next.js App Router
│   ├── types/       # TypeScript类型定义
│   ├── publisher/   # 发布者相关页面
│   ├── api/         # API路由
│   └── layout.tsx   # 根布局
├── components/      # 可重用组件
│   ├── ui/          # UI基础组件
│   ├── providers/   # 上下文提供者
│   └── promptBox/   # 提示框组件
├── hooks/           # 自定义React钩子
├── lib/             # 工具函数和库
├── store/           # Zustand状态管理
├── api/             # API相关代码
│   ├── handlers/    # API处理函数
│   ├── endpoints/   # API端点
│   └── types/       # API类型定义
└── styles/          # 全局样式
```

## 2. 代码风格

### 2.1 TypeScript规范
- **使用严格模式**: `"strict": true` in tsconfig.json
- **类型定义**: 为所有变量、函数参数和返回值添加类型注解
- **接口命名**: 使用PascalCase，如 `User`, `TaskListResponse`
- **类型别名**: 使用PascalCase，如 `type UserId = string`
- **枚举命名**: 使用PascalCase，如 `enum TaskStatus`

### 2.2 JavaScript规范
- **变量声明**: 使用 `const` 优先，需要重新赋值时使用 `let`
- **箭头函数**: 优先使用箭头函数，特别是在回调中
- **模板字符串**: 使用模板字符串替代字符串拼接
- **解构赋值**: 优先使用解构赋值
- **可选链**: 使用可选链操作符 `?.` 处理可能为null/undefined的值
- **空值合并**: 使用空值合并操作符 `??` 提供默认值

### 2.3 命名规范
- **文件命名**: 使用kebab-case，如 `user-profile.tsx`
- **组件命名**: 使用PascalCase，如 `UserProfile.tsx`
- **函数命名**: 使用camelCase，如 `fetchUserData()`
- **变量命名**: 使用camelCase，如 `userName`
- **常量命名**: 使用UPPER_SNAKE_CASE，如 `API_BASE_URL`
- **私有属性**: 使用下划线前缀，如 `_privateMethod()`

### 2.4 代码格式
- **缩进**: 使用2个空格
- **行宽**: 最大120字符
- **分号**: 使用分号
- **引号**: 使用单引号 `'` 或反引号 `` ` ``
- **大括号**: 遵循K&R风格，左大括号在同一行
- **空格**: 在操作符前后添加空格，如 `a + b`

## 3. API调用规范

### 3.1 React Query使用
- **Query Keys**: 使用数组形式，如 `['tasks', { page: 1, status: 'active' }]`
- **缓存策略**: 根据数据类型设置合理的 `staleTime` 和 `gcTime`
- **错误处理**: 实现全面的错误处理
- **加载状态**: 合理处理加载状态
- **数据失效**: 在数据变更时主动失效相关缓存

### 3.2 API响应处理
- **统一格式**: 所有API响应使用统一的格式
- **错误处理**: 统一处理API错误
- **类型安全**: 为所有API响应定义TypeScript类型
- **数据验证**: 验证API返回的数据

### 3.3 请求优化
- **批量请求**: 合并相似的API请求
- **防抖节流**: 对频繁的API请求实现防抖或节流
- **重试机制**: 实现合理的错误重试机制
- **超时处理**: 设置适当的请求超时时间

## 4. 状态管理规范

### 4.1 Zustand使用
- **Store设计**: 按功能划分Store，如 `userStore`, `taskStore`
- **状态定义**: 明确区分状态和操作
- **类型安全**: 为所有Store添加TypeScript类型
- **持久化**: 对于需要持久化的状态，使用localStorage
- **性能优化**: 使用 `getState()` 避免不必要的渲染

### 4.2 状态管理最佳实践
- **最小化状态**: 只存储必要的状态
- **派生状态**: 使用selector计算派生状态
- **状态同步**: 确保状态在不同组件间的同步
- **错误处理**: 在状态中包含错误信息
- **加载状态**: 在状态中包含加载状态

## 5. 组件开发规范

### 5.1 React组件
- **函数组件**: 优先使用函数组件
- **Hooks使用**: 遵循Hooks规则，只在顶层调用
- **Props类型**: 为所有组件Props添加TypeScript类型
- **默认Props**: 为可选Props提供默认值
- **组件拆分**: 将复杂组件拆分为更小的可重用组件
- **性能优化**: 使用 `React.memo`, `useMemo`, `useCallback` 优化性能

### 5.2 Next.js组件
- **Server Components**: 对于不需要客户端交互的组件，使用Server Components
- **Client Components**: 对于需要客户端交互的组件，使用Client Components
- **数据获取**: 在Server Components中使用 `fetch` 获取数据
- **路由处理**: 使用 `useRouter` 和 `usePathname` 处理路由

## 6. 性能优化

### 6.1 代码分割
- **动态导入**: 使用 `React.lazy` 和 `Suspense` 实现代码分割
- **路由分割**: Next.js自动为每个路由生成单独的代码块
- **组件分割**: 将大型组件拆分为更小的组件
- **依赖分割**: 优化node_modules的打包

### 6.2 资源优化
- **图片优化**: 使用 `next/image` 优化图片加载
- **字体优化**: 使用 `next/font` 优化字体加载
- **CSS优化**: 使用Tailwind CSS的JIT模式减少CSS体积
- **静态资源**: 为静态资源设置合理的缓存策略

### 6.3 网络优化
- **CDN使用**: 使用CDN加速静态资源
- **HTTP/2**: 启用HTTP/2
- **压缩**: 启用gzip或brotli压缩
- **预加载**: 预加载关键资源
- **缓存策略**: 实现有效的缓存策略

### 6.4 运行时优化
- **减少重渲染**: 优化React组件的渲染性能
- **虚拟滚动**: 对长列表实现虚拟滚动
- **防抖节流**: 对频繁的事件处理函数实现防抖或节流
- **Web Workers**: 将复杂计算移至Web Workers

## 7. 安全规范

### 7.1 数据安全
- **加密存储**: 对敏感数据进行加密存储
- **传输安全**: 使用HTTPS
- **CORS配置**: 正确配置CORS
- **CSRF保护**: 实现CSRF保护
- **XSS防护**: 防止跨站脚本攻击

### 7.2 认证授权
- **Token管理**: 安全管理JWT令牌
- **会话管理**: 合理管理用户会话
- **权限检查**: 实现细粒度的权限检查
- **密码存储**: 使用bcrypt等算法存储密码

### 7.3 代码安全
- **依赖检查**: 定期检查依赖项的安全漏洞
- **输入验证**: 验证所有用户输入
- **错误处理**: 不向用户暴露详细的错误信息
- **日志记录**: 合理记录日志，不记录敏感信息

## 8. 测试规范

### 8.1 测试策略
- **单元测试**: 测试独立的函数和组件
- **集成测试**: 测试组件之间的交互
- **端到端测试**: 测试完整的用户流程

### 8.2 测试工具
- **单元测试**: Jest, React Testing Library
- **集成测试**: React Testing Library
- **端到端测试**: Cypress

### 8.3 测试覆盖率
- **目标覆盖率**: 80%以上
- **关键代码**: 确保关键代码的测试覆盖率
- **测试质量**: 关注测试的质量，而不仅仅是覆盖率

## 9. 部署规范

### 9.1 构建流程
- **类型检查**: 在构建前运行 `tsc --noEmit`
- **代码检查**: 在构建前运行 `eslint`
- **测试**: 在构建前运行测试套件
- **优化**: 启用生产环境优化

### 9.2 环境配置
- **环境变量**: 使用 `.env` 文件管理环境变量
- **不同环境**: 为不同环境配置不同的设置
- **密钥管理**: 安全管理生产环境密钥

### 9.3 部署策略
- **CI/CD**: 使用持续集成和持续部署
- **滚动部署**: 实现零停机部署
- **回滚机制**: 实现快速回滚机制
- **监控**: 部署后监控应用状态

## 10. Agent Skill 标准化

### 10.1 核心原则
- **安全性优先**: 严禁暴露敏感信息
- **效率原则**: 避免冗余的API调用
- **可靠性原则**: 确保代码的健壮性
- **用户体验**: 关注用户体验

### 10.2 思考流程
1. **任务分析**: 理解需求，分析依赖，制定计划
2. **代码分析**: 探索代码库，理解现有逻辑
3. **实现**: 遵循规范，模块化设计，错误处理
4. **验证**: 测试，代码检查，性能验证

### 10.3 行为准则
- **严禁**生成包含错误的代码
- **严禁**生成不安全的代码
- **严禁**生成低质量的代码
- **必须**遵循项目的代码风格和架构
- **必须**实现全面的错误处理
- **必须**确保代码的类型安全性

## 11. 个人开发规范 Prompt

### 11.1 标准 Prompt

```
# 个人开发规范

## 核心指令

### 1. 任务理解
- 仔细阅读用户的请求，确保完全理解需求
- 分析任务的复杂性和依赖关系
- 制定详细的执行计划

### 2. 代码分析
- 探索代码库结构，了解现有代码
- 分析项目的技术栈和依赖
- 理解现有代码的逻辑和架构
- 精确定位需要修改的代码位置

### 3. 实现要求
- **严格遵循**项目的技术栈和架构
- **使用TypeScript**，确保类型安全
- **使用React Query**管理API请求和缓存
- **使用Zustand**管理状态
- **使用Tailwind CSS**进行样式设计
- **实现全面的错误处理**
- **优化性能**，避免冗余操作
- **确保安全性**，不暴露敏感信息

### 4. 代码风格
- **文件命名**: kebab-case
- **组件命名**: PascalCase
- **函数命名**: camelCase
- **变量命名**: camelCase
- **常量命名**: UPPER_SNAKE_CASE
- **接口命名**: PascalCase
- **类型别名**: PascalCase
- **缩进**: 2个空格
- **行宽**: 最大120字符
- **使用分号**
- **使用单引号**

### 5. API调用
- **使用React Query**的useQuery和useMutation
- **定义清晰的Query Keys**
- **设置合理的缓存策略**
- **实现错误处理和重试机制**
- **优化请求，避免冗余调用**

### 6. 状态管理
- **使用Zustand**创建模块化的store
- **定义清晰的状态和操作**
- **添加TypeScript类型**
- **实现状态持久化**
- **优化性能，避免不必要的渲染**

### 7. 组件开发
- **使用函数组件**
- **为Props添加类型**
- **使用React.memo等优化性能**
- **拆分复杂组件**
- **遵循Next.js的Server Components和Client Components规范**

### 8. 性能优化
- **实现代码分割**
- **优化资源加载**
- **使用缓存策略**
- **减少重渲染**
- **优化网络请求**

### 9. 安全规范
- **不暴露敏感信息**
- **实现输入验证**
- **使用安全的存储方式**
- **遵循CORS和CSRF防护**
- **定期检查依赖漏洞**

### 10. 验证和测试
- **运行类型检查**
- **运行代码检查**
- **测试功能**
- **验证性能**
- **确保安全性**

### 11. 输出规范
- **提供清晰的实现说明**
- **包含必要的代码注释**
- **遵循项目的文档规范**
- **提供测试和验证方法**
- **确保代码的可维护性**

### 12. 禁止事项
- **严禁**生成包含错误的代码
- **严禁**生成不安全的代码
- **严禁**生成低质量的代码
- **严禁**忽略项目的代码规范
- **严禁**在没有充分测试的情况下提交代码

### 13. 最佳实践
- **模块化设计**
- **关注点分离**
- **代码复用**
- **性能优化**
- **用户体验**

## 项目特定信息

### 技术栈
- Next.js 14.2.5
- TypeScript 5.3.3
- Zustand 4.5.7
- React Query 5.90.20
- Ant Design 6.0.0
- Tailwind CSS 3.3.6
- Axios 1.12.2

### 目录结构
- src/app/: Next.js App Router
- src/components/: 可重用组件
- src/hooks/: 自定义React钩子
- src/lib/: 工具函数和库
- src/store/: Zustand状态管理
- src/api/: API相关代码

### 现有功能
- 用户认证和授权
- 任务管理
- 支付密码设置
- 仪表盘和统计

### 注意事项
- **移除了路由加密**，使用直接路径
- **集成了React Query**，用于API请求管理
- **实现了无感Token校验**，每小时轮询一次
- **添加了多级缓存**，优化性能
- **修改了支付密码提示**，只在登录后提示一次

## 执行要求

### 1. 计划
- 分析任务需求
- 制定详细的执行计划
- 识别潜在风险

### 2. 执行
- 严格按照计划执行
- 遵循所有开发规范
- 实现高质量代码

### 3. 验证
- 测试所有功能
- 检查代码质量
- 验证性能和安全性

### 4. 交付
- 提供清晰的实现说明
- 确保代码的可维护性
- 满足用户的所有需求
```

### 11.2 使用说明

1. **复制**上述标准Prompt到你的工作环境
2. **根据具体任务**调整Prompt中的细节
3. **在开始编码前**，仔细阅读Prompt
4. **在编码过程中**，参考Prompt的要求
5. **在完成后**，根据Prompt进行验证

### 11.3 示例使用

**任务**: 添加一个新的任务列表页面

**执行流程**:
1. **任务分析**: 理解需求，分析依赖，制定计划
2. **代码分析**: 探索现有的任务相关代码，了解API结构
3. **实现**: 
   - 创建新的页面组件
   - 使用React Query获取任务列表
   - 实现状态管理
   - 添加错误处理和加载状态
4. **验证**: 测试功能，检查代码质量，优化性能
5. **交付**: 提供实现说明，确保代码可维护

## 12. 总结

本规范旨在提供一个全面的开发指南，帮助开发者创建高质量、安全、高效的代码。遵循这些规范可以提高开发效率，减少错误，改善代码质量，确保项目的成功。

通过严格遵守这些规范，你将能够:
- 编写更清晰、更可维护的代码
- 减少错误和bug的数量
- 提高应用的性能和安全性
- 提供更好的用户体验
- 成为一名更专业的开发者

---

**版本**: 1.0.0
**更新日期**: 2026-01-28
**适用范围**: 个人前端开发项目
